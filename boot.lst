001   0000             	MODULE 	boot
002   0000             	DEVICE 	ZXSPECTRUM48
003   0000             	OUTPUT	boot.cod
004   0000             ; ███████████████ M O V E  T O  S R A M ███████████████████████████████████████	
005   0000             			org 49000
006   BF68 F3          			di
007   BF69 AF          			xor a
008   BF6A D3 17       			out (23),a
009   BF6C 01 3B 20    			ld bc,#203B				//ZXi portselect
010   BF6F ED 79       			out (c),a
011   BF71 01 3B 21    			ld bc,#213B
012   BF74 3E 01       			ld a,1					//HW - 1 - MB03+
013   BF76 ED 79       			out (c),a
014   BF78 3E A0       			ld a, 160
015   BF7A D3 17       			out (23),a
016   BF7C 21 00 C0    			ld hl,49152
017   BF7F 11 00 00    			ld de,0
018   BF82 01 00 40    			ld bc,16384
019   BF85 ED B0       			ldir
020   BF87 3E 80       			ld a,128
021   BF89 D3 17       			out (23),a
022   BF8B C7          			rst 0
023   BF8C             moveend			
024   BF8C 00          	BLOCK   (49152-moveend),0
025   C000             ; --------------- V A R I A B L E S ---------------------------------------			
026   C000             DMA 		equ #0B
027   C000             ULA			equ #FE
028   C000             zvukcompile	equ 60000 ; adresa zkopilovaneho zvuku 
029   C000             ; --------------- M A I N C O D E ---------------------------------------
030   C000             			org 49152
031   C000             			
032   C000             maincode
033   C000             			
034   C000             //			org 0
035   C000             			DISP 0
036   0000 F3          boot		di
037   0001 31 00 00    			ld sp,0
038   0004 3E C3       			ld	a, #C3		; Z80DMA command: WR6: Reset
039   0006 D3 0B       			out	(DMA), a
040   0008 AF          			xor	a
041   0009 ED 47       			ld	i, a
042   000B D3 FE       			out (ULA),a
043   000D 21 FF 5A    				ld	hl, 5AFFh
044   0010 11 FE 5A    				ld	de, 5AFEh
045   0013 01 FF 1A    				ld	bc, 1AFFh
046   0016 77          				ld	(hl), a
047   0017 ED B8       				lddr			; Clear	videoram (black	screen)
048   0019             				
049   0019             	INCLUDE "effect.a80"		; Busy nonbootdisk effect
001+  0019             ;	DEVICE	ZXSPECTRUM48
002+  0019             ;	OUTPUT	effect.cod
003+  0019             ;	org	#8000
004+  0019             
005+  0019             ;start	xor	a
006+  0019             ;	out	(#fe),a
007+  0019 3E 03       	ld	a,#03
008+  001B 21 00 40    	ld	hl,#4000
009+  001E 11 01 40    	ld	de,#4001
010+  0021 01 00 01    nn1	ld	bc,#0100
011+  0024 75          	ld	(hl),l
012+  0025 ED B0       	ldir
013+  0027 06 06       	ld	b,#06
014+  0029 36 7E       	ld	(hl),#7e
015+  002B ED B0       	ldir
016+  002D 04          	inc	b
017+  002E 75          	ld	(hl),l
018+  002F ED B0       	ldir
019+  0031 3D          	dec	a
020+  0032 20 ED       	jr	nz,nn1
021+  0034 11 00 00    	ld de,0			;LMN start	
022+  0037 44          nn2	ld	b,h
023+  0038 4D          	ld	c,l
024+  0039 29          	add	hl,hl
025+  003A 29          	add	hl,hl
026+  003B 29          	add	hl,hl
027+  003C 09          	add	hl,bc
028+  003D 01 0C 00    	ld	bc,12
029+  0040 09          	add	hl,bc
030+  0041 7C          	ld	a,h
031+  0042 E6 03       	and	#03
032+  0044 F6 58       	or	#58
033+  0046 67          	ld	h,a
034+  0047 EB          	ex	de,hl
035+  0048             
036+  0048 7C          	ld a,h			;LMN
037+  0049 FE 20       	cp 32			;LMN lenght
038+  004B 28 09       	jr z, end		;LMN
039+  004D             	
040+  004D ED A0       	ldi
041+  004F EB          	ex	de,hl
042+  0050 06 1E       	ld	b,#1e		;LMN (was #20) speed
043+  0052 10 FE       wait	djnz	wait
044+  0054 18 E1       	jr	nn2
045+  0056             end
046+  0056             ;		ret   ; for testing
047+  0056             ;	OUTEND
048+  0056             ;	SAVESNA	"effect.sna",start
049+  0056             
050   0056             /*				
051   0056~            			ld bc, 203Bh		; ZXi portselect
052   0056~            			out (c),a
053   0056~            			ld a,8				; dissable monsterblaster till bsdos uses port 0Fh
054   0056~            			ld bc, 213Bh		; ZXi port0 - Audio
055   0056~            			out (c),a	
056   0056             */			
057   0056 DB FE       			in	a, (ULA)
058   0058 2F          			cpl
059   0059 E6 1F       			and	1Fh
060   005B 28 3B       			jr  z,endramtest	;testram if anykey
061   005D             ;			jr endramtest
062   005D             ; ███████████████ RAM TEST ███████████████████████████████████████
063   005D             ;it's comes from legacy MB02+ bootloader version 003
064   005D             
065   005D AF          ramtest xor a					
066   005E 21 00 40    		ld 	hl, #4000
067   0061 11 08 06    		ld	de, #0608
068   0064 01 FD 7F    		ld	bc, 32765
069   0067 ED 79       		out	(c), a
070   0069             
071   0069             ram_test_loop: 								
072   0069 2F          		cpl
073   006A 77          		ld	(hl), a
074   006B AE          		xor	(hl)
075   006C 77          		ld	(hl), a
076   006D AE          		xor	(hl)
077   006E 20 1A       		jr	nz, ram_fault
078   0070 2C          		inc	l
079   0071 20 F6       		jr	nz, ram_test_loop
080   0073 24          		inc	h
081   0074 20 F3       		jr	nz, ram_test_loop
082   0076 26 C0       		ld	h, #C0				; RAM pages start address
083   0078 7B          		ld	a, e
084   0079 BA          		cp	d
085   007A 20 01       		jr	nz, no_page5		; Don't test RAM page 5 again
086   007C 1D          		dec	e
087   007D             
088   007D             no_page5: 				
089   007D FE 03       		cp	3					; Don't test RAM page 2 again
090   007F 20 01       		jr	nz, no_page2
091   0081 1D          		dec	e
092   0082             
093   0082             no_page2: 				
094   0082 AF          		xor	a
095   0083 1D          		dec	e
096   0084 ED 59       		out	(c), e
097   0086 20 E1       		jr	nz, ram_test_loop
098   0088             ;endtest
099   0088 18 0E       		jr endramtest
100   008A             
101   008A             ram_fault: 				
102   008A 7B          		ld	a, e
103   008B D3 FE       		out	(254), a
104   008D             
105   008D             delay1: 					
106   008D 10 FE       		djnz	$
107   008F 2F          		cpl
108   0090 D3 FE       		out	(254), a
109   0092 06 07       		ld	b, 7
110   0094             
111   0094             delay2: 					
112   0094 10 FE       		djnz	$
113   0096 18 F2       		jr	ram_fault			
114   0098             ; ███████████████ E N D  R A M  T E S T ███████████████████████████████████████			
115   0098             			
116   0098             skipramtest			
117   0098             
118   0098 21 A6 00    endramtest	ld hl,ramcodeinrom
119   009B 11 A6 C0    			ld de,ramcode
120   009E 01 25 3C    			ld bc,endramcode-ramcode
121   00A1 ED B0       			ldir
122   00A3 C3 A6 C0    			jp ramcode
123   00A6             
124   00A6             ramcodeinrom	
125   00A6             
126   00A6             			ent						; restore address to compile to right place
127   C0A6             ramcode		
128   C0A6             
129   C0A6 CD 04 C5    			call cls.CLS
130   C0A9 3E 07       			ld   a,7
131   C0AB 21 00 58    			ld   HL,22528
132   C0AE 11 01 58    			ld   DE,22529
133   C0B1 01 FF 02    			ld   BC,767
134   C0B4 77          			ld   (HL),a
135   C0B5 ED B0       			ldir
136   C0B7 3E 00       			ld a,0
137   C0B9 32 67 CF    			ld (txy32.orflag),a
138   C0BC 3E 42       			ld a,66
139   C0BE 32 B4 CE    			ld (txy32.T32_ATT),a
140   C0C1 01 00 00    			ld	bc,#0000
141   C0C4 CD A4 C1    			call fall1
142   C0C7 3E 46       			ld a,70
143   C0C9 32 B4 CE    			ld (txy32.T32_ATT),a
144   C0CC 01 10 00    			ld	bc,#0010
145   C0CF CD A4 C1    			call fall1
146   C0D2 3E 44       			ld a,68
147   C0D4 32 B4 CE    			ld (txy32.T32_ATT),a
148   C0D7 01 2E 00    			ld	bc,#002E
149   C0DA CD A4 C1    			call fall1
150   C0DD 3E 45       			ld a,69
151   C0DF 32 B4 CE    			ld (txy32.T32_ATT),a
152   C0E2 01 59 00    			ld	bc,#0059
153   C0E5 CD A4 C1    			call fall1
154   C0E8             
155   C0E8 3E 01       			ld a,1
156   C0EA 32 67 CF    			ld (txy32.orflag),a
157   C0ED 3E 42       			ld a,66
158   C0EF 32 B4 CE    			ld (txy32.T32_ATT),a
159   C0F2 01 00 00    			ld	bc,#0000
160   C0F5 CD B5 C1    			call fall2	
161   C0F8 3E 46       			ld a,70
162   C0FA 32 B4 CE    			ld (txy32.T32_ATT),a
163   C0FD 01 10 00    			ld	bc,#0010
164   C100 CD B5 C1    			call fall2			
165   C103 3E 44       			ld a,68
166   C105 32 B4 CE    			ld (txy32.T32_ATT),a
167   C108 01 28 00    			ld	bc,#0028
168   C10B CD C6 C1    			call fall3
169   C10E 3E 45       			ld a,69
170   C110 32 B4 CE    			ld (txy32.T32_ATT),a
171   C113 01 58 00    			ld	bc,#0058
172   C116 CD D7 C1    			call fall4
173   C119             			
174   C119 3E 00       			ld a,0
175   C11B 32 67 CF    			ld (txy32.orflag),a
176   C11E 3E 45       			ld a,69
177   C120 32 B4 CE    			ld (txy32.T32_ATT),a
178   C123 01 57 2A    			ld	bc,#2A57
179   C126 11 60 2A    			ld  de,#2A60
180   C129 3E 4B       			ld a,#4B
181   C12B CD 5F C1    			call wide1
182   C12E 06 01       			ld b,1
183   C130 CD E8 C5    			call wait.wait
184   C133 3E 44       			ld a,68
185   C135 32 B4 CE    			ld (txy32.T32_ATT),a
186   C138 01 2A 2A    			ld	bc,#2A2A
187   C13B 11 35 2A    			ld  de,#2A35
188   C13E 3E 1F       			ld a,#1F
189   C140 CD 5F C1    			call wide1
190   C143             
191   C143 21 F4 FA    			ld hl, STRIPS
192   C146 01 00 48    			ld bc,#4800
193   C149 ED 43 61 CF 			ld	(txy32.cursor),bc
194   C14D E5          			push hl
195   C14E CD 9B CE    			call txy32.txy
196   C151 E1          			pop hl
197   C152 01 00 A8    			ld bc,#A800
198   C155 ED 43 61 CF 			ld	(txy32.cursor),bc
199   C159 CD 9B CE    			call txy32.txy
200   C15C             
201   C15C             //			call iinkey.ANYKEY	
202   C15C C3 35 C2    			jp follow1
203   C15F             			
204   C15F F5          wide1		push af
205   C160 D5          			push de
206   C161 C5          			push bc
207   C162 ED 43 61 CF 			ld	(txy32.cursor),bc
208   C166 3E 84       			ld a,132
209   C168 CD B5 CE    			call txy32.xy
210   C16B C1          			pop bc
211   C16C C5          			push bc
212   C16D 3E 08       			ld a,8
213   C16F 80          			add a,b
214   C170 47          			ld b,a
215   C171 3E 86       			ld a,134
216   C173 ED 43 61 CF 			ld	(txy32.cursor),bc
217   C177 CD B5 CE    			call txy32.xy
218   C17A C1          			pop bc
219   C17B D1          			pop de
220   C17C C5          			push bc
221   C17D D5          			push de
222   C17E ED 53 61 CF 			ld	(txy32.cursor),de
223   C182 3E 81       			ld a,129
224   C184 CD B5 CE    			call txy32.xy
225   C187 D1          			pop de
226   C188 D5          			push de
227   C189 3E 08       			ld a,8
228   C18B 82          			add a,d
229   C18C 57          			ld d,a
230   C18D ED 53 61 CF 			ld	(txy32.cursor),de
231   C191 3E 83       			ld a,131
232   C193 CD B5 CE    			call txy32.xy
233   C196 06 04       			ld b,4
234   C198 CD E8 C5    			call wait.wait
235   C19B D1          			pop de
236   C19C C1          			pop bc
237   C19D F1          			pop af
238   C19E 1C          			inc e
239   C19F 0D          			dec c
240   C1A0 B9          			cp c
241   C1A1 20 BC       			jr nz,wide1
242   C1A3 C9          			ret
243   C1A4             			
244   C1A4 C5          fall1		push bc
245   C1A5 CD 12 C2    			call singledot
246   C1A8 06 01       			ld b,1
247   C1AA CD E8 C5    			call wait.wait
248   C1AD C1          			pop bc
249   C1AE 04          			inc b
250   C1AF 3E 2B       			ld a,#2B
251   C1B1 B8          			cp b
252   C1B2 20 F0       			jr nz,fall1
253   C1B4 C9          			ret
254   C1B5 C5          fall2		push bc
255   C1B6 CD E8 C1    			call halfdot
256   C1B9 06 01       			ld b,1
257   C1BB CD E8 C5    			call wait.wait
258   C1BE C1          			pop bc
259   C1BF 04          			inc b
260   C1C0 3E 2B       			ld a,#2B
261   C1C2 B8          			cp b
262   C1C3 20 F0       			jr nz,fall2
263   C1C5 C9          			ret			
264   C1C6             	
265   C1C6 C5          fall3		push bc
266   C1C7 CD F6 C1    			call halfdot3
267   C1CA 06 01       			ld b,1
268   C1CC CD E8 C5    			call wait.wait
269   C1CF C1          			pop bc
270   C1D0 04          			inc b
271   C1D1 3E 2B       			ld a,#2B
272   C1D3 B8          			cp b
273   C1D4 20 F0       			jr nz,fall3
274   C1D6 C9          			ret	
275   C1D7             
276   C1D7 C5          fall4		push bc
277   C1D8 CD 04 C2    			call halfdot4
278   C1DB 06 01       			ld b,1
279   C1DD CD E8 C5    			call wait.wait
280   C1E0 C1          			pop bc
281   C1E1 04          			inc b
282   C1E2 3E 2B       			ld a,#2B
283   C1E4 B8          			cp b
284   C1E5 20 F0       			jr nz,fall4
285   C1E7 C9          			ret				
286   C1E8             	
287   C1E8 ED 43 61 CF halfdot     ld	(txy32.cursor),bc
288   C1EC 3E 84       			ld a,132
289   C1EE CD B5 CE    			call txy32.xy
290   C1F1 3E 85       			ld a,133
291   C1F3 C3 B5 CE    			jp txy32.xy
292   C1F6             
293   C1F6 ED 43 61 CF halfdot3    ld	(txy32.cursor),bc
294   C1FA 3E 88       			ld a,136
295   C1FC CD B5 CE    			call txy32.xy
296   C1FF 3E 89       			ld a,137
297   C201 C3 B5 CE    			jp txy32.xy	
298   C204             
299   C204 ED 43 61 CF halfdot4    ld	(txy32.cursor),bc
300   C208 3E 8A       			ld a,138
301   C20A CD B5 CE    			call txy32.xy
302   C20D 3E 8B       			ld a,139
303   C20F C3 B5 CE    			jp txy32.xy	
304   C212             			
305   C212 ED 43 61 CF singledot	ld	(txy32.cursor),bc
306   C216 3E 84       			ld a,132
307   C218 C5          			push bc
308   C219 CD B5 CE    			call txy32.xy
309   C21C 3E 85       			ld a,133
310   C21E CD B5 CE    			call txy32.xy
311   C221 C1          			pop	bc
312   C222 3E 08       			ld a,8
313   C224 80          			add a,b
314   C225 47          			ld b,a
315   C226 ED 43 61 CF 			ld	(txy32.cursor),bc	
316   C22A 3E 86       			ld a,134
317   C22C CD B5 CE    			call txy32.xy
318   C22F 3E 87       			ld a,135
319   C231 CD B5 CE    			call txy32.xy
320   C234 C9          			ret
321   C235             
322   C235 11 0F 05    follow1		ld de,#050F
323   C238 21 9E D7    	        ld hl,ultimatelogo
324   C23B 3E 0D       			ld a,13			// number of sprites in animations
325   C23D F5          1			push af
326   C23E D5          			push de
327   C23F E5          			push hl
328   C240 CD 78 CF    			call sprite2.OK
329   C243 06 0C       			ld b,12
330   C245 CD E8 C5    			call wait.wait
331   C248 E1          			pop hl
332   C249 11 14 00    			ld de,20			// lenght of sprite2
333   C24C 19          			add hl,de
334   C24D D1          			pop de
335   C24E 1C          			inc e
336   C24F F1          			pop af
337   C250 3D          			dec a
338   C251 20 EA       			jr nz,1B
339   C253             //Ultimate		
340   C253 11 00 05    			ld de,#0500
341   C256 21 A2 D8    	        ld hl,dots+38*0
342   C259 3E 06       			ld a,6			// number of sprites in animations
343   C25B F5          2			push af
344   C25C D5          			push de
345   C25D E5          			push hl
346   C25E             //			call sprite2.OK
347   C25E 06 09       			ld b,9
348   C260 CD E8 C5    			call wait.wait
349   C263 E1          			pop hl
350   C264 D1          			pop de
351   C265 1C          			inc e
352   C266 1C          			inc e
353   C267 F1          			pop af
354   C268 3D          			dec a
355   C269 20 F0       			jr nz,2B
356   C26B             			
357   C26B 11 00 00    			ld de,#0000
358   C26E 21 BC CF    	        ld hl,MB03pluslogo
359   C271 CD 78 CF    			call sprite2.OK
360   C274             /*			ld de,#040A
361   C274~            	        ld hl,CaroLogo
362   C274~            			call sprite2.OK
363   C274             */
364   C274             ;carymary         
365   C274 01 00 48    			 ld bc,#4800
366   C277 11 FF 48    			 ld de,#48ff
367   C27A CD 32 C4    			 call draw_jugo.DRAW
368   C27D             
369   C27D 01 7A 3D    			ld	bc,#3D7A
370   C280 ED 43 95 C6 			ld	(txy51.cursor),bc
371   C284 21 62 FA    			ld	hl,TEXT0
372   C287 CD F0 C5    			call txy51.txy
373   C28A 01 00 B8    			ld	bc,#B800
374   C28D ED 43 95 C6 			ld	(txy51.cursor),bc
375   C291 21 7D FA    			ld	hl,TEXT3
376   C294 CD F0 C5    			call txy51.txy
377   C297 01 00 B0    			ld	bc,#B000
378   C29A ED 43 95 C6 			ld	(txy51.cursor),bc
379   C29E 21 C5 FA    			ld	hl,TEXT2
380   C2A1 CD F0 C5    			call txy51.txy
381   C2A4 01 B1 A6    			ld	bc,#A6B1
382   C2A7 ED 43 95 C6 			ld	(txy51.cursor),bc
383   C2AB 21 B6 FC    			ld	hl,FW1
384   C2AE CD F0 C5    			call txy51.txy
385   C2B1 01 D9 A6    			ld	bc,#A6D9
386   C2B4 ED 43 95 C6 			ld	(txy51.cursor),bc
387   C2B8 21 C0 FC    			ld	hl,DATE
388   C2BB CD F0 C5    			call txy51.txy		
389   C2BE             
390   C2BE 01 00 50    			ld	bc,#5000
391   C2C1 ED 43 95 C6 			ld	(txy51.cursor),bc
392   C2C5 21 6D FB    			ld	hl,HW1
393   C2C8 CD F0 C5    			call txy51.txy
394   C2CB 01 03 58    			ld	bc,#5803
395   C2CE ED 43 95 C6 			ld	(txy51.cursor),bc
396   C2D2 21 7E FB    			ld	hl,HW2
397   C2D5 CD F0 C5    			call txy51.txy
398   C2D8 01 03 60    			ld	bc,#6003
399   C2DB ED 43 95 C6 			ld	(txy51.cursor),bc
400   C2DF 21 AA FB    			ld	hl,HW3
401   C2E2 CD F0 C5    			call txy51.txy
402   C2E5 01 03 68    			ld	bc,#6803
403   C2E8 ED 43 95 C6 			ld	(txy51.cursor),bc
404   C2EC 21 BF FB    			ld	hl,HW4
405   C2EF CD F0 C5    			call txy51.txy
406   C2F2 01 03 70    			ld	bc,#7003
407   C2F5 ED 43 95 C6 			ld	(txy51.cursor),bc
408   C2F9 21 D4 FB    			ld	hl,HW5
409   C2FC CD F0 C5    			call txy51.txy
410   C2FF 01 03 78    			ld	bc,#7803
411   C302 ED 43 95 C6 			ld	(txy51.cursor),bc
412   C306 21 F6 FB    			ld	hl,HW6
413   C309 CD F0 C5    			call txy51.txy
414   C30C             
415   C30C 01 00 80    			ld	bc,#8000
416   C30F ED 43 95 C6 			ld	(txy51.cursor),bc
417   C313 21 2A FC    			ld	hl,CONF1
418   C316 CD F0 C5    			call txy51.txy
419   C319 01 03 88    			ld	bc,#8803
420   C31C ED 43 95 C6 			ld	(txy51.cursor),bc
421   C320 21 40 FC    			ld	hl,CONF2
422   C323 CD F0 C5    			call txy51.txy
423   C326 01 03 90    			ld	bc,#9003
424   C329 ED 43 95 C6 			ld	(txy51.cursor),bc
425   C32D 21 76 FC    			ld	hl,CONF3
426   C330             //carymary2
427   C330 CD F0 C5    			call txy51.txy		
428   C333 01 00 AE    			 ld bc,#AE00
429   C336 11 FF AE    			 ld de,#AEff
430   C339 CD 32 C4    			 call draw_jugo.DRAW
431   C33C             			
432   C33C             /*			ld	bc,#9000
433   C33C~            			ld	(txy51.cursor),bc
434   C33C~            			ld	hl,TEXTTEST2
435   C33C~            			call txy51.txy			
436   C33C             */			
437   C33C CD 21 C5    1			call iinkey.IINKEY		; waiting for key
438   C33F 28 FB       			jr z,1B
439   C341 FE 11       			cp 11h					; break
440   C343 20 09       			jr nz,2F				; no break
441   C345 AF          			xor a					; break
442   C346 D3 17       			out (23),a 				; dissable MB03+ SRAM
443   C348 01 FD 7F    			ld bc,32765				; ZX128 rom
444   C34B ED 79       			out (c),a
445   C34D C7          			rst 0					; jp to 0
446   C34E             2			
447   C34E FE 31       			cp '1'					//key 1
448   C350 20 42       			jr nz,3F
449   C352 3E 81       			ld a,129				; install bsrom from "rom"
450   C354 D3 17       			out (23),a
451   C356 21 00 00    			ld hl,0
452   C359 11 00 80    			ld de,32768
453   C35C 01 00 40    			ld bc,16384
454   C35F ED B0       			ldir
455   C361 3E 60       			ld a,96
456   C363 D3 17       			out (23), a
457   C365 21 00 80    			ld hl,32768
458   C368 11 00 00    			ld de,0
459   C36B 01 00 40    			ld bc,16384
460   C36E ED B0       			ldir
461   C370 3E 82       			ld a,130				; install bsrom from "rom"
462   C372 D3 17       			out (23),a
463   C374 21 00 00    			ld hl,0
464   C377 11 00 80    			ld de,32768
465   C37A 01 00 40    			ld bc,16384
466   C37D ED B0       			ldir
467   C37F 3E 61       			ld a,97
468   C381 D3 17       			out (23), a
469   C383 21 00 80    			ld hl,32768
470   C386 11 00 00    			ld de,0
471   C389 01 00 40    			ld bc,16384
472   C38C ED B0       			ldir
473   C38E 3E 40       			ld a,64
474   C390 D3 17       			out (23),a
475   C392 18 04       			jr 4F
476   C394             3			
477   C394 FE 32       			cp '2'					; key 2
478   C396 20 10       			jr nz, 5F				
479   C398             			
480   C398 21 A2 D8    4			ld hl,easyhdd			; run EasyHDD
481   C39B 11 00 80    			ld de,32768
482   C39E 01 C0 21    			ld bc,easyhddend-easyhdd
483   C3A1 ED B0       			ldir					
484   C3A3 CD 00 80    			call 32768
485   C3A6 18 04       			jr 6F
486   C3A8             
487   C3A8 FE 65       5			cp 'e'					// key e
488   C3AA 20 07       			jr nz, 7F				// no key
489   C3AC             			
490   C3AC 3E 40       6			ld a,64					// 128K reset in BSROM140
491   C3AE D3 17       			out (23),a
492   C3B0 C3 06 39    			jp #3906				//jp to bsrom140
493   C3B3             			
494   C3B3 FE 64       7			cp 'd'
495   C3B5 20 16       			jr nz, 8F				
496   C3B7             			
497   C3B7 3E 83       			ld a,131
498   C3B9 D3 17       			out (23),a
499   C3BB 21 00 00    			ld hl,0
500   C3BE 11 78 69    			ld de,27000
501   C3C1 01 70 17    			ld bc,6000
502   C3C4 ED B0       			ldir
503   C3C6 3E 40       			ld a,64
504   C3C8 D3 17       			out (23),a
505   C3CA C3 78 69    			jp 27000
506   C3CD             			
507   C3CD FE 74       8			cp 't'					// key t - zx diagnostics
508   C3CF 20 05       			jr nz, 9F				// no key
509   C3D1 3E 84       			ld a,132
510   C3D3 D3 17       			out (23),a
511   C3D5 C7          			rst 0
512   C3D6 FE 70       9			cp 'p'					// key p - Papaya DOS- ESXDOS
513   C3D8 20 36       			jr nz, 10F				
514   C3DA AF          			xor a
515   C3DB D3 17       			out (23),a
516   C3DD 01 3B 20    			ld bc,#203B				//ZXi portselect
517   C3E0 ED 79       			out (c),a
518   C3E2 01 3B 21    			ld bc,#213B
519   C3E5 3E 02       			ld a,2					//HW - 2 - DIVMMC/DIVIDE
520   C3E7 ED 79       			out (c),a
521   C3E9 01 3B 20    			ld bc,#203B				//ZXi portselect 
522   C3EC 3E 02       			ld a,2
523   C3EE ED 79       			out (c),a
524   C3F0 01 3B 21    			ld bc,#213B
525   C3F3 3E 02       			ld a,2					//IDE - 2 PVL ports- DIVMMC/DIVIDE
526   C3F5 ED 79       			out (c),a
527   C3F7 3E 80       			ld a,128
528   C3F9 D3 E3       div_erase	out (#E3),a
529   C3FB 21 00 20    			ld hl,8192
530   C3FE 11 01 20    			ld de,8193
531   C401 01 FF 1F    			ld bc,8191
532   C404 75          			ld (hl),l
533   C405 ED B0       			ldir
534   C407 3C          			inc a
535   C408 FE 85       			cp 128+5
536   C40A 20 ED       			jr nz,div_erase			//delete first 32KB od DivIde RAM
537   C40C AF          			xor a					//is enought to erase bank0 or
538   C40D D3 E3       			out (#E3),a				//to force cold start zero $2dXX in page 0
539   C40F C7          			rst 0
540   C410 FE 52       10			cp "R"					//restart firmware
541   C412 20 01       			jr nz, 11F
542   C414 C7          			rst 0
543   C415 FE 6C       11			cp "l"					//Level 1 demo in 5 page
544   C417 C2 3C C3    			jp nz, 1B
545   C41A 3E 85       			ld a,133
546   C41C D3 17       			out (23),a
547   C41E 21 00 00    			ld hl,0
548   C421 11 00 68    			ld de,26624
549   C424 01 DF 1E    			ld bc,7903
550   C427 ED B0       			ldir
551   C429 AF          			xor a
552   C42A D3 17       			out (23),a
553   C42C 31 90 65    			ld sp,26000
554   C42F C3 00 68    			jp 26624
555   C432             			
556   C432             ; --------------- L I B R A R I E S ---------------------------------------	
557   C432             	
558   C432             //INCLUDE "nasobeniHLDE.a80"
559   C432             	INCLUDE "draw-jugo.a80"
001+  C432             ;rutina na kresleni cary. pochazi z nejakeho jugoslavskeho casaku
002+  C432             ;BC-ODKUD DE-KAM NAKRESLI CARU
003+  C432             ;POCATEK VLEVO NAHORE (0,0)
004+  C432             	module draw_jugo
005+  C432 7A          DRAW     LD   A,D
006+  C433 FE C0                CP   192
007+  C435 D0                   RET  NC
008+  C436 78                   LD   A,B
009+  C437 FE C0                CP   192
010+  C439 D0                   RET  NC
011+  C43A 3F                   CCF
012+  C43B 1F                   RRA
013+  C43C 37                   SCF
014+  C43D 1F                   RRA
015+  C43E A7                   AND  A
016+  C43F 1F                   RRA
017+  C440 A8                   XOR  B
018+  C441 E6 F8                AND  248
019+  C443 A8                   XOR  B
020+  C444 67                   LD   H,A
021+  C445 79                   LD   A,C
022+  C446 07                   RLCA
023+  C447 07                   RLCA
024+  C448 07                   RLCA
025+  C449 6F                   LD   L,A
026+  C44A E6 38                AND  56
027+  C44C 2F                   CPL
028+  C44D 32 52 C4             LD   (LAB+1),A
029+  C450 AF                   XOR  A
030+  C451 CB C7       LAB      SET  0,A
031+  C453 08                   EX   AF,AF'
032+  C454 7D                   LD   A,L
033+  C455 A8                   XOR  B
034+  C456 E6 C7                AND  199
035+  C458 A8                   XOR  B
036+  C459 07                   RLCA
037+  C45A 07                   RLCA
038+  C45B 6F                   LD   L,A
039+  C45C 78                   LD   A,B
040+  C45D 92                   SUB  D
041+  C45E 06 00                LD   B,0
042+  C460 30 03                JR   NC,N1
043+  C462 ED 44                NEG
044+  C464 04                   INC  B
045+  C465 57          N1       LD   D,A
046+  C466 79                   LD   A,C
047+  C467 93                   SUB  E
048+  C468 0E 00                LD   C,0
049+  C46A 30 03                JR   NC,N2
050+  C46C ED 44                NEG
051+  C46E 0C                   INC  C
052+  C46F 5F          N2       LD   E,A
053+  C470 08                   EX   AF,AF'
054+  C471 F5                   PUSH AF
055+  C472 B6                   OR   (HL)
056+  C473 77                   LD   (HL),A
057+  C474 F1                   POP  AF
058+  C475 08                   EX   AF,AF'
059+  C476 B2                   OR   D
060+  C477 C8                   RET  Z
061+  C478 E5                   PUSH HL
062+  C479 7A                   LD   A,D
063+  C47A BB                   CP   E
064+  C47B 38 37                JR   C,POX
065+  C47D 21 D8 C4             LD   HL,LEVO
066+  C480 CB 41                BIT  0,C
067+  C482 28 03                JR   Z,Y1
068+  C484 21 D3 C4             LD   HL,DESNO
069+  C487 22 A7 C4    Y1       LD   (DIA+1),HL
070+  C48A 21 F0 C4             LD   HL,GORE
071+  C48D CB 40                BIT  0,B
072+  C48F 28 03                JR   Z,Y2
073+  C491 21 DD C4             LD   HL,DOLE
074+  C494 22 AA C4    Y2       LD   (NAST+1),HL
075+  C497 4A                   LD   C,D
076+  C498 CB 39       N3       SRL  C
077+  C49A DD 62                LD   HX,D
078+  C49C 08                   EX   AF,AF'
079+  C49D 47                   LD   B,A
080+  C49E E1                   POP  HL
081+  C49F 79          LOOP     LD   A,C
082+  C4A0 93                   SUB  E
083+  C4A1 4F                   LD   C,A
084+  C4A2 30 05                JR   NC,NAST
085+  C4A4 82                   ADD  A,D
086+  C4A5 4F                   LD   C,A
087+  C4A6 CD 00 00    DIA      CALL 0
088+  C4A9 CD 00 00    NAST     CALL 0
089+  C4AC 78                   LD   A,B
090+  C4AD B6                   OR   (HL)
091+  C4AE 77                   LD   (HL),A
092+  C4AF DD 25                DEC  HX
093+  C4B1 20 EC                JR   NZ,LOOP
094+  C4B3 C9                   RET
095+  C4B4 21 D8 C4    POX      LD   HL,LEVO
096+  C4B7 CB 41                BIT  0,C
097+  C4B9 28 03                JR   Z,X1
098+  C4BB 21 D3 C4             LD   HL,DESNO
099+  C4BE 22 AA C4    X1       LD   (NAST+1),HL
100+  C4C1 21 F0 C4             LD   HL,GORE
101+  C4C4 CB 40                BIT  0,B
102+  C4C6 28 03                JR   Z,X2
103+  C4C8 21 DD C4             LD   HL,DOLE
104+  C4CB 22 A7 C4    X2       LD   (DIA+1),HL
105+  C4CE 4B                   LD   C,E
106+  C4CF 5A                   LD   E,D
107+  C4D0 51                   LD   D,C
108+  C4D1 18 C5                JR   N3
109+  C4D3 CB 08       DESNO    RRC  B
110+  C4D5 D0                   RET  NC
111+  C4D6 23                   INC  HL
112+  C4D7 C9                   RET
113+  C4D8 CB 00       LEVO     RLC  B
114+  C4DA D0                   RET  NC
115+  C4DB 2B                   DEC  HL
116+  C4DC C9                   RET
117+  C4DD 24          DOLE     INC  H
118+  C4DE 7C                   LD   A,H
119+  C4DF E6 07                AND  7
120+  C4E1 C0                   RET  NZ
121+  C4E2 7C                   LD   A,H
122+  C4E3 D6 08                SUB  8
123+  C4E5 67                   LD   H,A
124+  C4E6 7D                   LD   A,L
125+  C4E7 C6 20                ADD  A,32
126+  C4E9 6F                   LD   L,A
127+  C4EA D0                   RET  NC
128+  C4EB 7C                   LD   A,H
129+  C4EC C6 08                ADD  A,8
130+  C4EE 67                   LD   H,A
131+  C4EF C9                   RET
132+  C4F0 25          GORE     DEC  H
133+  C4F1 7C                   LD   A,H
134+  C4F2 2F                   CPL
135+  C4F3 E6 07                AND  7
136+  C4F5 C0                   RET  NZ
137+  C4F6 7C                   LD   A,H
138+  C4F7 C6 08                ADD  A,8
139+  C4F9 67                   LD   H,A
140+  C4FA 7D                   LD   A,L
141+  C4FB D6 20                SUB  32
142+  C4FD 6F                   LD   L,A
143+  C4FE D0                   RET  NC
144+  C4FF 7C                   LD   A,H
145+  C500 D6 08                SUB  8
146+  C502 67                   LD   H,A
147+  C503 C9                   RET
148+  C504             	endmodule
149+  C504             
560   C504             	INCLUDE "cls.a80"
001+  C504             	module cls
002+  C504             CLS     
003+  C504 AF                  xor  a
004+  C505 D3 FE               out  (254),a
005+  C507 21 FF 5A    		ld	hl, 5AFFh
006+  C50A 11 FE 5A    		ld	de, 5AFEh
007+  C50D 01 FF 1A    		ld	bc, 1AFFh
008+  C510 77          		ld	(hl), a
009+  C511 ED B8       		lddr			; Clear	videoram (black	screen)
010+  C513 C9          		ret
011+  C514                     
012+  C514             	endmodule
561   C514             	INCLUDE "iinkey.a80"
001+  C514             	module iinkey
002+  C514 CD 21 C5    ANYKEY   call IINKEY
003+  C517 28 FB                jr   z,ANYKEY
004+  C519 F5                   push af
005+  C51A CD 21 C5    ANYKEY_0 call IINKEY
006+  C51D 20 FB                jr   nz,ANYKEY_0
007+  C51F F1                   pop  af
008+  C520 C9                   ret
009+  C521             ;------------------------------
010+  C521 E5          IINKEY   push hl
011+  C522 D5                   push de
012+  C523 C5                   push bc
013+  C524 01 FE 7F             ld   bc,#7FFE
014+  C527 26 00                ld   h,0
015+  C529 54                   ld   d,h
016+  C52A 5C                   ld   e,h
017+  C52B 2E 05       II1      ld   l,5
018+  C52D ED 78                in   a,(c)
019+  C52F 24          II2      inc  h
020+  C530 0F                   rrca
021+  C531 38 02                jr   c,II3
022+  C533 53                   ld   d,e
023+  C534 5C                   ld   e,h
024+  C535 2D          II3      dec  l
025+  C536 20 F7                jr   nz,II2
026+  C538 CB 08                rrc  b
027+  C53A 38 EF                jr   c,II1
028+  C53C 7B                   ld   a,e
029+  C53D FE 24                cp   #24
030+  C53F 20 03                jr   nz,II5
031+  C541 5A                   ld   e,d
032+  C542 16 24                ld   d,#24
033+  C544 FE 02       II5      cp   2
034+  C546 20 03                jr   nz,II6
035+  C548 5A                   ld   e,d
036+  C549 16 02                ld   d,2
037+  C54B 21 6D C5    II6      ld   hl,IINN
038+  C54E AF                   xor  a
039+  C54F AA                   xor  d
040+  C550 28 12                jr   z,II7
041+  C552 21 BF C5             ld   hl,IISS
042+  C555 FE 02                cp   2
043+  C557 28 0B                jr   z,II7
044+  C559 21 96 C5             ld   hl,IICS
045+  C55C FE 24                cp   #24
046+  C55E 28 04                jr   z,II7
047+  C560 3E 01                ld   a,1
048+  C562 18 04                jr   II8
049+  C564             
050+  C564 16 00       II7      ld   d,0
051+  C566 19                   add  hl,de
052+  C567 7E                   ld   a,(hl)
053+  C568 A7          II8      and  a
054+  C569 C1                   pop  bc
055+  C56A D1                   pop  de
056+  C56B E1                   pop  hl
057+  C56C C9                   ret
058+  C56D             
059+  C56D 00 20 1C    IINN     defb 0," ",#1C
060+  C570 6D 6E 62             defb "mnb"
061+  C573 0D                   defb 13
062+  C574 6C 6B 6A 68          defb "lkjh"
063+  C578 706F697579           defb "poiuy"
064+  C57D 3039383736           defb "09876"
065+  C582 3132333435           defb "12345"
066+  C587 7177657274           defb "qwert"
067+  C58C 6173646667           defb "asdfg"
068+  C591 00                   defb 0
069+  C592 7A 78 63 76          defb "zxcv"
070+  C596             
071+  C596 00 11 0E    IICS     defb 0,#11,#0E
072+  C599 4D 4E 42             defb "MNB"
073+  C59C 02                   defb 2
074+  C59D 4C 4B 4A 48          defb "LKJH"
075+  C5A1 504F495559           defb "POIUY"
076+  C5A6 0C0F090B0A           defb #0C,#0F,9,#0B,#0A
077+  C5AB 0706040508           defb 7,6,4,5,8
078+  C5B0 5157455254           defb "QWERT"
079+  C5B5 4153444647           defb "ASDFG"
080+  C5BA 1F                   defb #1F
081+  C5BB 5A 58 43 56          defb "ZXCV"
082+  C5BF             
083+  C5BF 00 10 1E    IISS     defb 0,16,#1E
084+  C5C2 2E 2C 2A             defb ".,*"
085+  C5C5 03                   defb 3
086+  C5C6 3D 2B 2D 5E          defb "=+-^"
087+  C5CA 22                   defb 34 ;"
088+  C5CB 3B 7F 7D 7B          defb ";}{"
089+  C5CF 5F29282726           defb "_)('&"
090+  C5D4 2140232425           defb "!@#$%"
091+  C5D9 12 13 14             defb #12,#13,#14
092+  C5DC 3C 3E                defb "<>"
093+  C5DE 7E 7C                defb "~|"
094+  C5E0 5C                   defb 92 ;\
095+  C5E1 7B                   defb 123 ;{
096+  C5E2 7D                   defb 125 ;}
097+  C5E3 1D                   defb #1D
098+  C5E4 3A 60 3F 2F          defb ":`?/"
099+  C5E8             
100+  C5E8             	endmodule
562   C5E8             	INCLUDE "wait.a80"
001+  C5E8             	module wait
002+  C5E8             wait
003+  C5E8             //	ex (SP),IX
004+  C5E8             //	ex (SP),IX
005+  C5E8 2B          	dec hl
006+  C5E9 7C          	ld a,h
007+  C5EA BD          	cp l
008+  C5EB 20 FB       	jr nz,wait
009+  C5ED 10 F9       	djnz wait
010+  C5EF C9          	ret
011+  C5F0             
012+  C5F0             	endmodule
563   C5F0             //	INCLUDE "t42.a80"
564   C5F0             //	INCLUDE "txy.a80"
565   C5F0             	INCLUDE "txy51.a80"
001+  C5F0             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
002+  C5F0             ; Poziciovy print 42*27 znakov ;
003+  C5F0             ;  + znakovy subor 6*7 bodov   ;
004+  C5F0             ; (vytvoreny pre disasembler)  ;
005+  C5F0             ; . -28.05.1988- Busy software ;
006+  C5F0             ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
007+  C5F0             ;DEMO:napiste:asm,dbg,rpp,g
008+  C5F0             //Original by BusySoft
009+  C5F0             	MODULE txy51
010+  C5F0 7E          txy	 	 ld   a,(hl)
011+  C5F1 E6 7F                and  127
012+  C5F3             /*         cp   13
013+  C5F3                      jr   z,T42_ZMEN */
014+  C5F3 FE 10                cp   16
015+  C5F5 28 0B                jr	  z,colorchange
016+  C5F7 E5                   push hl
017+  C5F8 CD 0A C6             call xy
018+  C5FB E1                   pop  hl
019+  C5FC             /*         ld   a,(T42_BORE)
020+  C5FC~                     dec  a
021+  C5FC~                     cp   c
022+  C5FC~                     jr   c,T42_ZMEN
023+  C5FC                      inc  c */
024+  C5FC 7E          T42_BACK ld   a,(hl)
025+  C5FD 17                   rla
026+  C5FE D8                   ret  c
027+  C5FF 23                   inc  hl
028+  C600 18 EE                jr   txy
029+  C602             
030+  C602             colorchange
031+  C602 23          			inc hl
032+  C603 7E          			ld a,(hl)
033+  C604 32 09 C6    			ld (T42_ATT),a
034+  C607 18 F3       			jr T42_BACK	
035+  C609 00          T42_ATT		defb 0	
036+  C60A             
037+  C60A             //exampleBusy
038+  C60A             /*
039+  C60A~            start	ld	hl,#4000
040+  C60A~            	ld	de,#4001
041+  C60A~            	ld	bc,#17ff
042+  C60A~            	ld	(hl),#00
043+  C60A~            	ldir
044+  C60A~            	ld	hl,#0202
045+  C60A~            	ld	(cursor),hl
046+  C60A~            	ld	hl,text
047+  C60A~            aaa	ld	a,(hl)
048+  C60A~            	call	xy
049+  C60A~            	inc	hl
050+  C60A~            	jr	nz,aaa
051+  C60A~            	ld	a,' '
052+  C60A~            bbb	ld	b,a
053+  C60A~            	call	xy
054+  C60A~            	ld	a,b
055+  C60A~            	inc	a
056+  C60A~            	cp	#80
057+  C60A~            	jr	c,bbb
058+  C60A~            	ld	hl,#2758
059+  C60A~            	exx
060+  C60A~            	ret
061+  C60A~            
062+  C60A~            text	db	'*** Rutina print'
063+  C60A~            		db	' 42*27 znakov v '
064+  C60A~            		db	'obraze ***'
065+  C60A~            		db	'        Priklad '
066+  C60A~            		db	'vypisu:         '
067+  C60A~            		db	'          '
068+  C60A~            		db	#00
069+  C60A             		*/
070+  C60A             ;main code
071+  C60A A7          xy	and	a
072+  C60B C8          	ret	z
073+  C60C D9          	exx
074+  C60D ED 4B 95 C6 	ld	bc,(cursor)
075+  C611 11 9B C6    xy8	ld	de,znaky
076+  C614 26 00       	ld	h,#00
077+  C616 6F          	ld	l,a
078+  C617 29          	add	hl,hl
079+  C618 29          	add	hl,hl
080+  C619 29          	add	hl,hl
081+  C61A 19          	add	hl,de
082+  C61B E5          	push	hl
083+  C61C FD E1       	pop	iy
084+  C61E DD 26 08    	ld	xh,#08
085+  C621 78          xy8dd	ld	a,b
086+  C622 FE C0       	cp	#c0
087+  C624 30 38       	jr	nc,xyend
088+  C626             ;	call	#22b1
089+  C626             
090+  C626 A7          	and a
091+  C627 1F          	rra
092+  C628 37          	scf
093+  C629 1F          	rra
094+  C62A A7          	and a
095+  C62B 1F          	rra
096+  C62C A8          	xor b
097+  C62D E6 F8       	and 248
098+  C62F A8          	xor b
099+  C630 67          	ld h,a
100+  C631 79          	ld a,c
101+  C632 07          	rlca
102+  C633 07          	rlca
103+  C634 07          	rlca
104+  C635 A8          	xor b
105+  C636 E6 C7       	and 199
106+  C638 A8          	xor b
107+  C639 07          	rlca
108+  C63A 07          	rlca
109+  C63B 6F          	ld l,a
110+  C63C 79          	ld a,c
111+  C63D E6 07       	and 07
112+  C63F             
113+  C63F FD 56 00    	ld	d,(iy+#00)
114+  C642 1E 00       	ld	e,#00
115+  C644 28 07       	jr	z,xy8bb
116+  C646 CB 1A       xy8cc	rr	d
117+  C648 CB 1B       	rr	e
118+  C64A 3D          	dec	a
119+  C64B 20 F9       	jr	nz,xy8cc
120+  C64D 7A          xy8bb	ld	a,d
121+  C64E B6          	or	(hl)
122+  C64F 77          	ld	(hl),a
123+  C650 23          	inc	hl
124+  C651 7B          	ld	a,e
125+  C652 B6          	or	(hl)
126+  C653 77          	ld	(hl),a
127+  C654 04          	inc	b
128+  C655 FD 23       	inc	iy
129+  C657 DD 25       	dec	xh
130+  C659 20 C6       	jr	nz,xy8dd
131+  C65B CD 7C C6    	call T51_COLOR
132+  C65E DD 21 91 C6 xyend	ld	ix,flag0
133+  C662 DD 7E 04    	ld	a,(ix+#04)
134+  C665 C6 05       	add	a,5
135+  C667 DD 77 04    	ld	(ix+#04),a
136+  C66A FE FD       	cp	255-2
137+  C66C 38 0C       	jr	c,xystop
138+  C66E DD 36 04 02 	ld	(ix+#04),2
139+  C672 DD 7E 05    	ld	a,(ix+#05)
140+  C675 C6 07       	add	a,7
141+  C677 DD 77 05    	ld	(ix+#05),a
142+  C67A D9          xystop	exx
143+  C67B C9          	ret
144+  C67C             
145+  C67C             T51_COLOR
146+  C67C 3A 09 C6    				ld a,(T42_ATT)
147+  C67F B7          				or a
148+  C680 C8          				ret z
149+  C681             ; pokud je nula, tak se neobarvuje
150+  C681 25          				dec h
151+  C682 2D          				dec l
152+  C683             
153+  C683 7C          				ld a,h
154+  C684 0F          				rrca
155+  C685 0F          				rrca
156+  C686 0F          				rrca
157+  C687 E6 03       				and 3
158+  C689 F6 58       				or 88
159+  C68B 67          				ld h,a
160+  C68C 3A 09 C6    				ld a,(T42_ATT)
161+  C68F 77          				ld (hl),a
162+  C690 C9          				ret
163+  C691             ;systemove premenne:(pre disu)
164+  C691             
165+  C691 00          flag0	db	#00
166+  C692 00          flag1	db	#00
167+  C693 00          flag2	db	#00
168+  C694 00          inp	db	#00
169+  C695             
170+  C695             cursor
171+  C695 00          xxx	db	#00
172+  C696 00          yyy	db	#00
173+  C697 00 00       leni	dw	0
174+  C699 00 00       adr	dw	0
175+  C69B             
176+  C69B             znaky
177+  C69B              INCBIN zx51.ch6
178+  CE9B             
179+  CE9B             	ENDMODULE
566   CE9B             	INCLUDE "txy32.a80"
001+  CE9B             //LMN128-Jan Kucera-Zlin/CZ
002+  CE9B             //added OR Flag
003+  CE9B             //Original by BusySoft
004+  CE9B             	MODULE txy32
005+  CE9B 7E          txy	 	 ld   a,(hl)
006+  CE9C E6 7F                and  127
007+  CE9E             /*         cp   13
008+  CE9E                      jr   z,T42_ZMEN */
009+  CE9E FE 10                cp   16
010+  CEA0 28 0B                jr	  z,colorchange
011+  CEA2 E5                   push hl
012+  CEA3 CD B5 CE             call xy
013+  CEA6 E1                   pop  hl
014+  CEA7             /*         ld   a,(T42_BORE)
015+  CEA7~                     dec  a
016+  CEA7~                     cp   c
017+  CEA7~                     jr   c,T42_ZMEN
018+  CEA7                      inc  c */
019+  CEA7 7E          T32_BACK ld   a,(hl)
020+  CEA8 17                   rla
021+  CEA9 D8                   ret  c
022+  CEAA 23                   inc  hl
023+  CEAB 18 EE                jr   txy
024+  CEAD             
025+  CEAD             colorchange
026+  CEAD 23          			inc hl
027+  CEAE 7E          			ld a,(hl)
028+  CEAF 32 B4 CE    			ld (T32_ATT),a
029+  CEB2 18 F3       			jr T32_BACK	
030+  CEB4 00          T32_ATT		defb 0	
031+  CEB5             
032+  CEB5 A7          xy	and	a
033+  CEB6 C8          	ret	z
034+  CEB7 D9          	exx
035+  CEB8 ED 4B 61 CF 	ld	bc,(cursor)
036+  CEBC 11 9B C6    xy8	ld	de,boot.txy51.znaky
037+  CEBF 26 00       	ld	h,#00
038+  CEC1 6F          	ld	l,a
039+  CEC2 29          	add	hl,hl
040+  CEC3 29          	add	hl,hl
041+  CEC4 29          	add	hl,hl
042+  CEC5 19          	add	hl,de
043+  CEC6 E5          	push hl
044+  CEC7 FD E1       	pop	iy
045+  CEC9 DD 26 08    	ld	xh,#08
046+  CECC 78          xy8dd	ld	a,b
047+  CECD FE C0       	cp	#c0
048+  CECF 30 48       	jr	nc,xyend
049+  CED1             ;	call	#22b1
050+  CED1             
051+  CED1 A7          	and a
052+  CED2 1F          	rra
053+  CED3 37          	scf
054+  CED4 1F          	rra
055+  CED5 A7          	and a
056+  CED6 1F          	rra
057+  CED7 A8          	xor b
058+  CED8 E6 F8       	and 248
059+  CEDA A8          	xor b
060+  CEDB 67          	ld h,a
061+  CEDC 79          	ld a,c
062+  CEDD 07          	rlca
063+  CEDE 07          	rlca
064+  CEDF 07          	rlca
065+  CEE0 A8          	xor b
066+  CEE1 E6 C7       	and 199
067+  CEE3 A8          	xor b
068+  CEE4 07          	rlca
069+  CEE5 07          	rlca
070+  CEE6 6F          	ld l,a
071+  CEE7 79          	ld a,c
072+  CEE8 E6 07       	and 07
073+  CEEA             
074+  CEEA FD 56 00    	ld	d,(iy+#00)
075+  CEED             //	ld	e,#00
076+  CEED 28 48       	jr	z,xy8bbnew 		//kulata pozice, staci vypsat jen jeden atribut
077+  CEEF 1E 00       	ld e,0
078+  CEF1 CB 1A       xy8cc rr	d
079+  CEF3 CB 1B       	rr	e
080+  CEF5 3D          	dec	a
081+  CEF6 20 F9       	jr	nz,xy8cc   
082+  CEF8             xy8bb
083+  CEF8 3A 67 CF    	ld a,(orflag)
084+  CEFB A7          	and a
085+  CEFC 7A          	ld a,d
086+  CEFD 20 01       	jr nz,1F
087+  CEFF B6          	or	(hl)
088+  CF00 77          1	ld	(hl),a
089+  CF01 CD 46 CF        call T32_COLOR
090+  CF04 23          	inc	hl
091+  CF05 3A 67 CF    	ld a,(orflag)
092+  CF08 A7          	and a
093+  CF09 7B          	ld a,e
094+  CF0A 20 01       	jr nz,2F
095+  CF0C B6          	or	(hl)				
096+  CF0D 77          2	ld	(hl),a
097+  CF0E CD 46 CF        call T32_COLOR
098+  CF11 04          3	inc	b
099+  CF12 FD 23       	inc	iy
100+  CF14 DD 25       	dec	xh
101+  CF16             //    call T32_COLOR
102+  CF16 C2 CC CE    	jp	nz,xy8dd
103+  CF19             //	call T32_COLOR
104+  CF19 DD 21 5D CF xyend	ld	ix,flag0
105+  CF1D DD 7E 04    	ld	a,(ix+#04)
106+  CF20 C6 08       	add	a,8
107+  CF22 DD 77 04    	ld	(ix+#04),a
108+  CF25 FE F8       	cp	255-7
109+  CF27 38 0C       	jr	c,xystop
110+  CF29 DD 36 04 02 	ld	(ix+#04),2
111+  CF2D DD 7E 05    	ld	a,(ix+#05)
112+  CF30 C6 08       	add	a,8
113+  CF32 DD 77 05    	ld	(ix+#05),a
114+  CF35 D9          xystop	exx
115+  CF36 C9          	ret
116+  CF37             xy8bbnew
117+  CF37 3A 67 CF    	ld a,(orflag)
118+  CF3A A7          	and a
119+  CF3B 7A          	ld a,d
120+  CF3C 20 01       	jr nz,4F
121+  CF3E B6          	or (hl)
122+  CF3F 77          4	ld (hl),a
123+  CF40 CD 46 CF        call T32_COLOR
124+  CF43 23          	inc hl
125+  CF44 18 CB       	jr 3B
126+  CF46             	
127+  CF46 F5          T32_COLOR		push af
128+  CF47 3A B4 CE    				ld a,(T32_ATT)
129+  CF4A B7          				or a
130+  CF4B C8          				ret z
131+  CF4C E5          				push hl
132+  CF4D             ; pokud je nula, tak se neobarvuje
133+  CF4D             
134+  CF4D             //				inc h
135+  CF4D             //				inc l
136+  CF4D             
137+  CF4D 7C          				ld a,h
138+  CF4E 0F          				rrca
139+  CF4F 0F          				rrca
140+  CF50 0F          				rrca
141+  CF51 E6 03       				and 3
142+  CF53 F6 58       				or 88
143+  CF55 67          				ld h,a
144+  CF56 3A B4 CE    				ld a,(T32_ATT)
145+  CF59 77          				ld (hl),a
146+  CF5A E1          				pop hl
147+  CF5B F1          				pop af
148+  CF5C C9          				ret
149+  CF5D             ;systemove premenne:(pre disu)
150+  CF5D             
151+  CF5D 00          flag0	db	#00
152+  CF5E 00          flag1	db	#00
153+  CF5F 00          flag2	db	#00
154+  CF60 00          inp	db	#00
155+  CF61             
156+  CF61             cursor
157+  CF61 00          xxx	db	#00
158+  CF62 00          yyy	db	#00
159+  CF63 00 00       leni	dw	0
160+  CF65 00 00       adr	dw	0
161+  CF67             
162+  CF67             
163+  CF67 01          orflag  db  #01
164+  CF68             //znaky
165+  CF68             // INCBIN zx51.ch6
166+  CF68             
167+  CF68             	ENDMODULE
567   CF68             	INCLUDE "sprite2.a80"
001+  CF68             ; zobrazi sprite dle cisla v A pozice a data spritu jsou v tabulce na adrese HL; priklad nakonci!!!
002+  CF68             ; nebo DE-pozice, HL-adresa (rutina OK)
003+  CF68             ; zobrazuje sprites z programu SpriteEdit typ 2
004+  CF68             	module sprite2
005+  CF68             SP_      
006+  CF68             ;        ld   hl,SP_TAB
007+  CF68 87                   add  a,a
008+  CF69 87                   add  a,a
009+  CF6A 16 00                ld   d,0
010+  CF6C 5F                   ld   e,a
011+  CF6D 19                   add  hl,de
012+  CF6E 5E                   ld   e,(hl)
013+  CF6F 23                   inc  hl
014+  CF70 56                   ld   d,(hl)
015+  CF71 23                   inc  hl
016+  CF72 D5             			 push de
017+  CF73 5E                   ld   e,(hl)
018+  CF74 23                   inc  hl
019+  CF75 56                   ld   d,(hl)
020+  CF76 EB                   ex   de,hl
021+  CF77 D1                   pop de
022+  CF78                      
023+  CF78             
024+  CF78             ;------------------------------
025+  CF78             OK       
026+  CF78 46                    ld b,(hl)
027+  CF79 23          					inc hl
028+  CF7A 4E                    ld c,(hl)
029+  CF7B 23                    inc hl
030+  CF7C 7A                   ld   a,d
031+  CF7D 0F                   rrca
032+  CF7E 0F                   rrca
033+  CF7F 0F                   rrca
034+  CF80 E6 E0                and  %11100000
035+  CF82 83                   add  a,e
036+  CF83 5F                   ld   e,a
037+  CF84 7A                   ld   a,d
038+  CF85 E6 18                and  24
039+  CF87 F6 40                or   64
040+  CF89 57                   ld   d,a
041+  CF8A             
042+  CF8A D5          OK_SEM   push de
043+  CF8B C5                   push bc
044+  CF8C 7A                   ld   a,d
045+  CF8D 0F                   rrca
046+  CF8E 0F                   rrca
047+  CF8F 0F                   rrca
048+  CF90 E6 03                and  3
049+  CF92 F6 58                or   88
050+  CF94 57                   ld   d,a
051+  CF95             
052+  CF95             OK_RADE1 ;call DE_BAJT
053+  CF95 7E                    ld a,(hl)
054+  CF96 23                    inc hl
055+  CF97             
056+  CF97 12                   ld   (de),a
057+  CF98 1C                   inc  e
058+  CF99 0D                   dec  c
059+  CF9A 20 F9                jr   nz,OK_RADE1
060+  CF9C C1                   pop  bc
061+  CF9D D1                   pop  de
062+  CF9E             
063+  CF9E D5          OK_DALSI push de
064+  CF9F C5                   push bc
065+  CFA0             OK_RADEK ;call DE_BAJT
066+  CFA0 7E                    ld a,(hl)
067+  CFA1 23                    inc hl
068+  CFA2             
069+  CFA2 12                   ld   (de),a
070+  CFA3 1C                   inc  e
071+  CFA4 0D                   dec  c
072+  CFA5 20 F9                jr   nz,OK_RADEK
073+  CFA7 C1                   pop  bc
074+  CFA8 D1                   pop  de
075+  CFA9 14                   inc  d
076+  CFAA 7A                   ld   a,d
077+  CFAB E6 07                and  7
078+  CFAD 20 EF                jr   nz,OK_DALSI
079+  CFAF 3E 20                ld   a,32
080+  CFB1 83                   add  a,e
081+  CFB2 5F                   ld   e,a
082+  CFB3 3F                   ccf
083+  CFB4 9F                   sbc  a,a
084+  CFB5 E6 F8                and  -8
085+  CFB7 82                   add  a,d
086+  CFB8 57                   ld   d,a
087+  CFB9 10 CF                djnz OK_SEM
088+  CFBB C9                   ret
089+  CFBC             
090+  CFBC             /*
091+  CFBC~            SP_TAB   defw #0B00  ;kam zobrazit
092+  CFBC~                     defw 32768 ;odkud
093+  CFBC~            
094+  CFBC~            
095+  CFBC             */
096+  CFBC             	endmodule
568   CFBC             MB03pluslogo
569   CFBC             	INCBIN "MB03+LOGOv2.bin"
570   D79E             ultimatelogo	
571   D79E             	INCBIN "ULTIMATE.bin"
572   D8A2             dots	
573   D8A2             //	INCBIN "DOTS.bin"	
574   D8A2             /*CaroLogo
575   D8A2             	INCBIN "CaroLogo.bin" */
576   D8A2             /*
577   D8A2~            NewdimLogo
578   D8A2~            	INCBIN "NewdimLogo.bin"
579   D8A2~            eightbc_i
580   D8A2~            	INCBIN "8BC_I.cde"
581   D8A2~            EasyLogoSmall
582   D8A2~            	INCBIN "EasyLogoSmall.bin"
583   D8A2             */	
584   D8A2             easyhdd	
585   D8A2             	INCBIN "easyhdd.out"
586   FA62             easyhddend
587   FA62             /*
588   FA62~            zvuk
589   FA62~            	INCBIN "ZVUK.BIN"
590   FA62~            zvukend
591   FA62             */
592   FA62             
593   FA62             /*@SP_TAB
594   FA62~            @TAB_sprite1
595   FA62~            		 DEFB 10,4
596   FA62~                     DEFW CaroLogo
597   FA62~                     DEFB 24,20
598   FA62~                     DEFW NewdimLogo
599   FA62~                     defb 0,21
600   FA62~                     defw eightbc_i
601   FA62~                     defb 1,2
602   FA62~                     defw eightbc_i
603   FA62~                     defb 25,2
604   FA62~                     defw EasyLogoSmall
605   FA62             */		 
606   FA62             ; --------------- T E X T---------------------------------------
607   FA62             TEXT0 	 dc 16,69,"LMN128-Jan Kucera-Zlin/CZ"		 
607   FA62 10454C4D4E3132382D4A616E204B75636572612D5A6C696E2F43DA
608   FA7D             TEXT3    dc 16,6,"break-ZXROM  1-BSDOS+EasyHDD  2-EasyHDD "
608   FA7D 1006627265616B2D5A58524F4D2020312D4253444F532B456173794844442020
608   FA9D 322D45617379484444A0
609   FAA7             TEXT1    dc 16,69,"MB03+ Ultimate firmware 1.28"
609   FAA7 10454D4230332B20556C74696D617465206669726D7761726520312E32B8
610   FAC5             TEXT2	 dc 16,6,"e-128K reset  d-Devastace+  t-Diag  p-ESXDOS "
610   FAC5 1006652D3132384B2072657365742020642D4465766173746163652B2020742D
610   FAE5 446961672020702D455358444F53A0
611   FAF4 10 42 20 20 STRIPS	db 16,66,32,32
612   FAF8 10 46 20 20 		db 16,70,32,32
613   FAFC             		db 16,68,32,32,32,32,32
613   FAFC 10442020202020
614   FB03             		dc 16,69,32,32,32,32,32+128
614   FB03 104520202020A0
615   FB0A             
616   FB0A             TEXTTEST dc 16,6,"0123456789 128 WADHTUTTUU ZX Spectrum 128+2"
616   FB0A 100630313233343536373839203132382057414448545554545555205A582053
616   FB2A 7065637472756D203132382BB2
617   FB37             TEXTTEST2 dc 16,6,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwyxz"
617   FB37 10064142434445464748494A4B4C4D4E4F505152535455565758595A61626364
617   FB57 65666768696A6B6C6D6E6F70717273747576777978FA
618   FB6D             HW1		db 16,67,"HARDWARE: "
618   FB6D 104348415244574152453A20
619   FB79 1007312EB0  		dc 16,7,"1.0"
620   FB7E             HW2		db 16,3,"FPGA: "
620   FB7E 1003465047413A20
621   FB86             		dc 16,7,"Xilinx SPARTAN-6 XC6SLX9 / 100 MHz"
621   FB86 100758696C696E78205350415254414E2D3620584336534C5839202F20313030
621   FBA6 204D48FA
622   FBAA             HW3		db 16,3,"RTC: "
622   FBAA 10035254433A20
623   FBB1             		dc 16,7,"Maxim DS3234"
623   FBB1 10074D6178696D204453333233B4
624   FBBF             HW4		db 16,3,"SRAM: " 
624   FBBF 10035352414D3A20
625   FBC7             		dc 16,7,"8192 KBytes"
625   FBC7 100738313932204B42797465F3
626   FBD4             HW5		db 16,3,"STORAGE: "
626   FBD4 100353544F524147453A20
627   FBDF             		dc 16,7,"CompactFlash, microSD"
627   FBDF 1007436F6D70616374466C6173682C206D6963726F53C4
628   FBF6             HW6		db 16,3,"OTHERS: "
628   FBF6 10034F54484552533A20
629   FC00             		dc 16,7,"USB, Wifi ESP8266, Atmel MEGA32U4, 8xLED"
629   FC00 10075553422C205769666920455350383236362C2041746D656C204D45474133
629   FC20 3255342C2038784C45C4
630   FC2A             
631   FC2A             CONF1	db 16,67,"CONFIGURATION: "
631   FC2A 1043434F4E46494755524154494F4E3A20
632   FC3B 1007312EB5  		dc 16,7,"1.5"
633   FC40             CONF2	db 16,3,"TurboSound: "
633   FC40 1003547572626F536F756E643A20
634   FC4E             		db 16,7,"ON  ",16,3,"SounDrive: ",16,7,"ON  ",16,3,"SAA1099: "
634   FC4E 10074F4E20201003536F756E44726976653A2010074F4E202010035341413130
634   FC6E 39393A20
635   FC72 10 07 4F CE 		dc 16,7,"ON"
636   FC76             CONF3	db 16,3,"DMA: "
636   FC76 1003444D413A20
637   FC7D             		db 16,7,"ON  ",16,3,"IDE: ",16,7,"ON  ",16,3,"SD: ",16,7,"ON  ",16,3,"RTC: ",16,7,"OFF ",16,3,"Wifi: "
637   FC7D 10074F4E202010034944453A2010074F4E2020100353443A2010074F4E202010
637   FC9D 035254433A2010074F4646201003576966693A20
638   FCB1 10074F46C6  		dc 16,7,"OFF"		
639   FCB6             FW1		dc 16,0,"FW:1.28/"
639   FCB6 100046573A312E3238AF
640   FCC0 10 00       DATE	db 16,0
641   FCC2             		  LUA ALLPASS
642   FCC2~            			_pc('db	"' .. os.date("%Y%m%d") .. '"') 
643   FCC2             db	"20190213"
643   FCC2 3230313930323133
643   FCCA             		  ENDLUA
644   FCCA A0          		dc " " 
645   FCCB             		//block 8 // kompenzace delky souboru kvuli os.date
646   FCCB             endramcode			
647   FCCB             		
648   FCCB             	savesna "boot.sna",ramcode//maincode//ramcode	
649   FCCB             	ENDMODULE	

Value    Label
------ - -----------------------------------------------------------
0xBF8C   boot.moveend
0x000B   boot.DMA
0x00FE   boot.ULA
0xEA60 X boot.zvukcompile
0xC000 X boot.maincode
0x0000 X boot.boot
0x0021   boot.nn1
0x0037   boot.nn2
0x0056   boot.end
0x0052   boot.wait
0x0098   boot.endramtest
0x005D X boot.ramtest
0x0069   boot.ram_test_loop
0x008A   boot.ram_fault
0x007D   boot.no_page5
0x0082   boot.no_page2
0x008D X boot.delay1
0x0094 X boot.delay2
0x0098 X boot.skipramtest
0x00A6   boot.ramcodeinrom
0xC0A6   boot.ramcode
0xFCCB   boot.endramcode
0xC504   boot.cls.CLS
0xCF67   boot.txy32.orflag
0xCEB4   boot.txy32.T32_ATT
0xC1A4   boot.fall1
0xC1B5   boot.fall2
0xC1C6   boot.fall3
0xC1D7   boot.fall4
0xC15F   boot.wide1
0xC5E8   boot.wait.wait
0xFAF4   boot.STRIPS
0xCF61   boot.txy32.cursor
0xCE9B   boot.txy32.txy
0xC235   boot.follow1
0xCEB5   boot.txy32.xy
0xC212   boot.singledot
0xC1E8   boot.halfdot
0xC1F6   boot.halfdot3
0xC204   boot.halfdot4
0xD79E   boot.ultimatelogo
0xCF78   boot.sprite2.OK
0xD8A2   boot.dots
0xCFBC   boot.MB03pluslogo
0xC432   boot.draw_jugo.DRAW
0xC695   boot.txy51.cursor
0xFA62   boot.TEXT0
0xC5F0   boot.txy51.txy
0xFA7D   boot.TEXT3
0xFAC5   boot.TEXT2
0xFCB6   boot.FW1
0xFCC0   boot.DATE
0xFB6D   boot.HW1
0xFB7E   boot.HW2
0xFBAA   boot.HW3
0xFBBF   boot.HW4
0xFBD4   boot.HW5
0xFBF6   boot.HW6
0xFC2A   boot.CONF1
0xFC40   boot.CONF2
0xFC76   boot.CONF3
0xC521   boot.iinkey.IINKEY
0xD8A2   boot.easyhdd
0xFA62   boot.easyhddend
0xC3F9   boot.div_erase
0xC451   boot.draw_jugo.LAB
0xC465   boot.draw_jugo.N1
0xC46F   boot.draw_jugo.N2
0xC4B4   boot.draw_jugo.POX
0xC4D8   boot.draw_jugo.LEVO
0xC487   boot.draw_jugo.Y1
0xC4D3   boot.draw_jugo.DESNO
0xC4A6   boot.draw_jugo.DIA
0xC4F0   boot.draw_jugo.GORE
0xC494   boot.draw_jugo.Y2
0xC4DD   boot.draw_jugo.DOLE
0xC4A9   boot.draw_jugo.NAST
0xC498   boot.draw_jugo.N3
0xC49F   boot.draw_jugo.LOOP
0xC4BE   boot.draw_jugo.X1
0xC4CB   boot.draw_jugo.X2
0xC514   boot.iinkey.ANYKEY
0xC51A   boot.iinkey.ANYKEY_0
0xC52B   boot.iinkey.II1
0xC52F   boot.iinkey.II2
0xC535   boot.iinkey.II3
0xC544   boot.iinkey.II5
0xC54B   boot.iinkey.II6
0xC56D   boot.iinkey.IINN
0xC564   boot.iinkey.II7
0xC5BF   boot.iinkey.IISS
0xC596   boot.iinkey.IICS
0xC568   boot.iinkey.II8
0xC602   boot.txy51.colorchange
0xC60A   boot.txy51.xy
0xC5FC   boot.txy51.T42_BACK
0xC609   boot.txy51.T42_ATT
0xC611 X boot.txy51.xy8
0xC69B   boot.txy51.znaky
0xC621   boot.txy51.xy8dd
0xC65E   boot.txy51.xyend
0xC64D   boot.txy51.xy8bb
0xC646   boot.txy51.xy8cc
0xC67C   boot.txy51.T51_COLOR
0xC691   boot.txy51.flag0
0xC67A   boot.txy51.xystop
0xC692 X boot.txy51.flag1
0xC693 X boot.txy51.flag2
0xC694 X boot.txy51.inp
0xC695 X boot.txy51.xxx
0xC696 X boot.txy51.yyy
0xC697 X boot.txy51.leni
0xC699 X boot.txy51.adr
0xCEAD   boot.txy32.colorchange
0xCEA7   boot.txy32.T32_BACK
0xCEBC X boot.txy32.xy8
0xCECC   boot.txy32.xy8dd
0xCF19   boot.txy32.xyend
0xCF37   boot.txy32.xy8bbnew
0xCEF1   boot.txy32.xy8cc
0xCEF8 X boot.txy32.xy8bb
0xCF46   boot.txy32.T32_COLOR
0xCF5D   boot.txy32.flag0
0xCF35   boot.txy32.xystop
0xCF5E X boot.txy32.flag1
0xCF5F X boot.txy32.flag2
0xCF60 X boot.txy32.inp
0xCF61 X boot.txy32.xxx
0xCF62 X boot.txy32.yyy
0xCF63 X boot.txy32.leni
0xCF65 X boot.txy32.adr
0xCF68 X boot.sprite2.SP_
0xCF8A   boot.sprite2.OK_SEM
0xCF95   boot.sprite2.OK_RADE1
0xCF9E   boot.sprite2.OK_DALSI
0xCFA0   boot.sprite2.OK_RADEK
0xFAA7 X boot.TEXT1
0xFB0A X boot.TEXTTEST
0xFB37 X boot.TEXTTEST2
